<html>
	<head>
		<title>testing Statechart</title>
		<style type="text/css">
			@import "../../dojo/resources/dojo.css";
		</style>
		<script type="text/javascript" src="../../dojo/dojo.js" data-dojo-config="isDebug:true"></script>
		<script type="text/javascript">
			require(['dojo', 'doh', 'statechart/main', 'statechart/state'], function(dojo, doh, Statechart, State){
				doh.register([
					{
						name: 'isStatechart',
						runTest: function(t){
              var s = new Statechart({});

              t.assertTrue(s.isStatechart);
						}
          },

          {
            name: 'mixedinProperties',
            runTest: function (t) {
              var props = {
                name: 'testName',
                testFn: function () {
                }
              };

              var s = new Statechart(props);

              t.assertEqual(props.name, s.name);
              t.assertEqual(props.testFn, s.testFn);
            }
          },

          {
            name: 'initStatechart',
            runTest: function (t) {
              var s = new Statechart({});
              var s2 = new Statechart({
                rootState: new State({})
              });

              t.assertFalse(s.isInitalized);
              t.assertFalse(s2.isInitalized);

              s.initStatechart();
              s2.initStatechart();

              t.assertFalse(s.isInitalized);
              t.assertTrue(s2.isInitalized);
            }
          },

          {
            name: 'autoInit',
            runTest: function (t) {
              var s = new Statechart({ rootState: new State() }),
                  s2 = new Statechart({ autoInit: true, rootState: new State() });

              t.assertFalse(s.isInitalized);
              t.assertTrue(s2.isInitalized);
            }
          },

          {
            name: 'rootStateEnter',
            runTest: function (t) {
              var e = false,
                  rootState = new State({
                    enterState: function () {
                      e = true;
                    }
                  }),
                  s = new Statechart({ rootState: rootState });

                setTimeout(function () {
                  t.assertFalse(e);
                  s.initStatechart();

                  t.assertTrue(e);
                }, 100);
            }
          },

          {
            name: 'gotoState',
            runTest: function (t) {
              var c = 0,

              s = new Statechart({
                rootState: new State({
                  subStates: ['substate'],
                  enterState: function () {},

                  exitState: function () {
                    c++;
                  },

                  substate: new State({
                    subStates: ['sub2'],
                    enterState: function () {
                      c++;
                    },

                     sub2: new State({
                      enterState: function () {
                        c++;
                      }
                     })
                  })
                })
              });

              s.initStatechart();
              s.gotoState('substate');

              t.assertEqual(2, c);
              t.assertNotEqual(3, c);

              s.gotoState('substate.sub2');
              t.assertEqual(3, c);

              s.gotoState('substate');
              t.assertEqual(4, c);
            }
          },


          {
            name: 'gotoState with params',
            runTest: function (t) {
              var p = {name: 'test'};

              var s = new Statechart({
                rootState: new State({
                  subStates: ['substate'],
                  enterState: function () {},
                  exitState: function () {},

                  substate: new State({
                    enterState: function (params) {
                      t.assertEqual(params.name, p.name);
                    }
                  })
                })
              });

              s.initStatechart();
              s.gotoState('substate', p);
            }
          }
				]);

				doh.runOnLoad();
			});
		</script>
	</head>
	<body>
	</body>
</html>

